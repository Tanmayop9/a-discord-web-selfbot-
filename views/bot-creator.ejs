<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bot Creator - Discord Selfbot</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    .bot-creator-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .creator-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      animation: fadeIn 0.5s;
    }

    .creator-header h1 {
      margin: 0 0 10px 0;
      font-size: 32px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .creator-form {
      background: var(--card-bg);
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      animation: fadeIn 0.5s 0.1s backwards;
    }

    .form-section {
      margin-bottom: 25px;
    }

    .form-section label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-color);
    }

    .bot-names-input {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 5px;
      color: var(--text-color);
      font-family: 'Courier New', monospace;
      font-size: 14px;
      resize: vertical;
    }

    .bot-names-input::placeholder {
      color: var(--text-muted);
    }

    .intents-section {
      background: var(--hover-bg);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .intents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .intent-checkbox {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--card-bg);
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .intent-checkbox:hover {
      background: var(--hover-bg);
      transform: translateX(5px);
    }

    .intent-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .intent-label {
      font-size: 14px;
      color: var(--text-color);
    }

    .create-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn-create {
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-create:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-create:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .created-bots {
      animation: fadeIn 0.5s 0.2s backwards;
    }

    .bots-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .bot-card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #667eea;
      animation: slideIn 0.3s;
    }

    .bot-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .bot-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .bot-id {
      font-size: 12px;
      color: var(--text-muted);
      font-family: 'Courier New', monospace;
    }

    .bot-token-section {
      background: var(--hover-bg);
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
    }

    .token-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 5px;
    }

    .token-display {
      background: var(--input-bg);
      padding: 10px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      word-break: break-all;
      color: var(--text-color);
      position: relative;
    }

    .token-hidden {
      filter: blur(4px);
      user-select: none;
    }

    .bot-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn-small {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-copy {
      background: #43a047;
      color: white;
    }

    .btn-copy:hover {
      background: #388e3c;
    }

    .btn-show {
      background: #1976d2;
      color: white;
    }

    .btn-show:hover {
      background: #1565c0;
    }

    .btn-delete {
      background: #d32f2f;
      color: white;
    }

    .btn-delete:hover {
      background: #c62828;
    }

    .bot-meta {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .badge-enabled {
      background: rgba(67, 160, 71, 0.2);
      color: #43a047;
    }

    .badge-disabled {
      background: rgba(211, 47, 47, 0.2);
      color: #d32f2f;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .success-message {
      background: rgba(67, 160, 71, 0.1);
      border: 1px solid #43a047;
      color: #43a047;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      animation: fadeIn 0.3s;
    }

    .error-message {
      background: rgba(211, 47, 47, 0.1);
      border: 1px solid #d32f2f;
      color: #d32f2f;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      animation: fadeIn 0.3s;
    }

    .download-section {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
    }

    .btn-download {
      padding: 12px 30px;
      background: linear-gradient(135deg, #43a047 0%, #388e3c 100%);
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s;
    }

    .btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(67, 160, 71, 0.4);
    }

    .info-box {
      background: rgba(25, 118, 210, 0.1);
      border-left: 4px solid #1976d2;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }

    .info-box p {
      margin: 5px 0;
      font-size: 14px;
      color: var(--text-color);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-brand">
      <span class="brand-icon">üéÆ</span>
      <span class="brand-text">Discord Selfbot</span>
    </div>
    <div class="nav-links">
      <a href="/">Dashboard</a>
      <a href="/servers">Servers</a>
      <a href="/dms">DMs</a>
      <a href="/friends">Friends</a>
      <a href="/voice">Voice</a>
      <a href="/settings">Settings</a>
      <a href="/user-info">Profile</a>
    </div>
  </nav>

  <div class="bot-creator-container">
    <div class="creator-header">
      <h1>ü§ñ Bot Creator / Application Manager</h1>
      <p>Create multiple Discord bot applications at once with configurable intents</p>
    </div>

    <div class="info-box">
      <p>‚ö†Ô∏è <strong>Important:</strong> This feature allows you to create Discord bot applications using your user account.</p>
      <p>üìù Enter one bot name per line. You can create multiple bots simultaneously.</p>
      <p>üîê Tokens will be automatically saved to a downloadable text file.</p>
      <p>‚ö° Enable intents to allow your bots to receive events like messages, members, etc.</p>
    </div>

    <div id="messageContainer"></div>

    <div class="creator-form">
      <form id="botCreatorForm">
        <div class="form-section">
          <label for="botNames">Bot Names (one per line)</label>
          <textarea
            id="botNames"
            name="botNames"
            class="bot-names-input"
            placeholder="MyBot1
MyAwesomeBot
CoolBot2024
TestBot
..."
            rows="8"
          ></textarea>
          <small style="color: var(--text-muted); display: block; margin-top: 5px;">
            üí° Tip: Enter multiple bot names, each on a new line. All bots will be created at once.
          </small>
        </div>

        <div class="intents-section">
          <label>
            <input type="checkbox" id="enableAllIntents" checked>
            <strong>Enable All Intents (Recommended)</strong>
          </label>
          <p style="font-size: 14px; color: var(--text-muted); margin-top: 8px;">
            Enabling intents allows your bot to receive events. This includes privileged intents like members and presence.
          </p>
        </div>

        <div class="create-buttons">
          <button type="submit" class="btn-create" id="createBtn">
            üöÄ Create Bots
          </button>
          <button type="button" class="btn-create" onclick="document.getElementById('botNames').value = ''" style="background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);">
            üóëÔ∏è Clear Form
          </button>
        </div>
      </form>
    </div>

    <div class="created-bots">
      <h2>üì¶ Created Bots (<span id="botCount"><%= bots.length %></span>)</h2>
      
      <% if (bots.length > 0) { %>
        <div class="download-section">
          <p>üíæ Tokens have been saved. Download the file to keep them safe!</p>
          <a href="#" class="btn-download" onclick="alert('Tokens are saved after creation')">üì• Download All Tokens</a>
        </div>
      <% } %>

      <div class="bots-grid" id="botsGrid">
        <% bots.forEach(bot => { %>
          <div class="bot-card" data-bot-id="<%= bot.id %>">
            <div class="bot-card-header">
              <div>
                <div class="bot-name">
                  ü§ñ <%= bot.name %>
                </div>
                <div class="bot-id">ID: <%= bot.id %></div>
              </div>
              <span class="status-badge <%= bot.intentsEnabled ? 'badge-enabled' : 'badge-disabled' %>">
                <%= bot.intentsEnabled ? '‚úì Intents Enabled' : '‚úó No Intents' %>
              </span>
            </div>

            <div class="bot-token-section">
              <div class="token-label">Bot Token:</div>
              <div class="token-display token-hidden" id="token-<%= bot.id %>">
                <%= bot.token %>
              </div>
            </div>

            <div class="bot-meta">
              <div class="meta-item">
                üìÖ Created: <%= new Date(bot.createdAt).toLocaleDateString() %>
              </div>
              <div class="meta-item">
                üïí <%= new Date(bot.createdAt).toLocaleTimeString() %>
              </div>
            </div>

            <div class="bot-actions">
              <button class="btn-small btn-show" onclick="toggleToken('<%= bot.id %>')">
                üëÅÔ∏è Show/Hide
              </button>
              <button class="btn-small btn-copy" onclick="copyToken('<%= bot.id %>')">
                üìã Copy Token
              </button>
              <button class="btn-small btn-delete" onclick="deleteBot('<%= bot.id %>')">
                üóëÔ∏è Delete
              </button>
            </div>
          </div>
        <% }); %>
      </div>

      <% if (bots.length === 0) { %>
        <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
          <div style="font-size: 64px; margin-bottom: 20px;">ü§ñ</div>
          <h3>No Bots Created Yet</h3>
          <p>Create your first bot using the form above!</p>
        </div>
      <% } %>
    </div>
  </div>

  <script>
    document.getElementById('botCreatorForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const botNames = document.getElementById('botNames').value
        .split('\n')
        .filter(name => name.trim() !== '');
      
      if (botNames.length === 0) {
        showMessage('Please enter at least one bot name', 'error');
        return;
      }

      const enableIntents = document.getElementById('enableAllIntents').checked;
      const createBtn = document.getElementById('createBtn');
      const originalText = createBtn.innerHTML;
      
      createBtn.disabled = true;
      createBtn.innerHTML = '<span class="loading-spinner"></span> Creating...';
      
      try {
        const response = await fetch('/bot-creator/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ botNames, enableIntents })
        });
        
        const data = await response.json();
        
        if (data.success) {
          let message = `‚úÖ Successfully created ${data.bots.length} bot(s)!`;
          if (data.failed && data.failed.length > 0) {
            message += ` (${data.failed.length} failed)`;
          }
          showMessage(message, 'success');
          
          // Add download link
          if (data.downloadUrl) {
            const downloadHtml = `
              <div class="download-section" style="animation: fadeIn 0.3s;">
                <p>üíæ Tokens saved to file!</p>
                <a href="${data.downloadUrl}" class="btn-download" download>üì• Download Tokens File</a>
              </div>
            `;
            document.getElementById('messageContainer').insertAdjacentHTML('beforeend', downloadHtml);
          }
          
          // Add bots to grid
          data.bots.forEach(bot => {
            addBotCard(bot);
          });
          
          // Update count
          document.getElementById('botCount').textContent = 
            parseInt(document.getElementById('botCount').textContent) + data.bots.length;
          
          // Clear form
          document.getElementById('botNames').value = '';
        } else {
          showMessage('‚ùå ' + (data.error || 'Failed to create bots'), 'error');
        }
      } catch (error) {
        showMessage('‚ùå Error: ' + error.message, 'error');
      } finally {
        createBtn.disabled = false;
        createBtn.innerHTML = originalText;
      }
    });

    function addBotCard(bot) {
      const grid = document.getElementById('botsGrid');
      const card = document.createElement('div');
      card.className = 'bot-card';
      card.setAttribute('data-bot-id', bot.id);
      card.innerHTML = `
        <div class="bot-card-header">
          <div>
            <div class="bot-name">ü§ñ ${bot.name}</div>
            <div class="bot-id">ID: ${bot.id}</div>
          </div>
          <span class="status-badge ${bot.intentsEnabled ? 'badge-enabled' : 'badge-disabled'}">
            ${bot.intentsEnabled ? '‚úì Intents Enabled' : '‚úó No Intents'}
          </span>
        </div>
        <div class="bot-token-section">
          <div class="token-label">Bot Token:</div>
          <div class="token-display token-hidden" id="token-${bot.id}">
            ${bot.token}
          </div>
        </div>
        <div class="bot-meta">
          <div class="meta-item">
            üìÖ Created: ${new Date(bot.createdAt).toLocaleDateString()}
          </div>
          <div class="meta-item">
            üïí ${new Date(bot.createdAt).toLocaleTimeString()}
          </div>
        </div>
        <div class="bot-actions">
          <button class="btn-small btn-show" onclick="toggleToken('${bot.id}')">
            üëÅÔ∏è Show/Hide
          </button>
          <button class="btn-small btn-copy" onclick="copyToken('${bot.id}')">
            üìã Copy Token
          </button>
          <button class="btn-small btn-delete" onclick="deleteBot('${bot.id}')">
            üóëÔ∏è Delete
          </button>
        </div>
      `;
      grid.prepend(card);
    }

    function toggleToken(botId) {
      const tokenEl = document.getElementById('token-' + botId);
      tokenEl.classList.toggle('token-hidden');
    }

    async function copyToken(botId) {
      const tokenEl = document.getElementById('token-' + botId);
      const token = tokenEl.textContent.trim();
      
      try {
        await navigator.clipboard.writeText(token);
        showMessage('‚úÖ Token copied to clipboard!', 'success');
      } catch (error) {
        showMessage('‚ùå Failed to copy token', 'error');
      }
    }

    async function deleteBot(botId) {
      if (!confirm('Are you sure you want to delete this bot? This action cannot be undone!')) {
        return;
      }
      
      try {
        const response = await fetch('/bot-creator/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ botId })
        });
        
        const data = await response.json();
        
        if (data.success) {
          const card = document.querySelector(`[data-bot-id="${botId}"]`);
          if (card) {
            card.style.animation = 'fadeOut 0.3s';
            setTimeout(() => card.remove(), 300);
          }
          
          // Update count
          document.getElementById('botCount').textContent = 
            parseInt(document.getElementById('botCount').textContent) - 1;
          
          showMessage('‚úÖ Bot deleted successfully', 'success');
        } else {
          showMessage('‚ùå Failed to delete bot', 'error');
        }
      } catch (error) {
        showMessage('‚ùå Error: ' + error.message, 'error');
      }
    }

    function showMessage(message, type) {
      const container = document.getElementById('messageContainer');
      const messageEl = document.createElement('div');
      messageEl.className = type === 'success' ? 'success-message' : 'error-message';
      messageEl.textContent = message;
      
      container.appendChild(messageEl);
      
      setTimeout(() => {
        messageEl.style.animation = 'fadeOut 0.3s';
        setTimeout(() => messageEl.remove(), 300);
      }, 5000);
    }
  </script>

  <style>
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-10px); }
    }
  </style>
</body>
</html>
